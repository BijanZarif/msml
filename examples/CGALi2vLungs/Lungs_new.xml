<msml:msml xmlns:msml="http://sfb125.de/msml"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://sfb125.de/msml">

    <variables>
        <var name="segementation_voxel_image" value="case1_T00_labled.vti" type="segmentationImage" format="file.vtk"/>
        <var name="tet_only_mesh" value="case1_T00_tetmesh.vtk" type="linearMesh" format="file.vtk"/>
        <var name="combo_mesh" value="case1_T00_mesh_combo.vtk" type="linearMesh" format="file.vtk"/>
    </variables>

    <scene>
        <object id="lungPat">
            <mesh>
                <linearTet id="combo_mesh_in_simulation" mesh="${surfaceExtraction}"/>
            </mesh>

            <material>
                <region id="patMaterial01">
                    <indexgroup indices="${bodyToIndexGroup}"/>
                    <linearElastic youngModulus="100" poissonRatio="0.4"/>
                    <mass density="0.001"/>
                </region>
                <region id="patMaterial02">
                    <indexgroup indices="${bonesToIndexGroup}"/>
                    <linearElastic youngModulus="19000" poissonRatio="0.4"/>
                    <mass density="0.001"/>
                </region>
                <region id="patMaterial03">
                    <indexgroup indices="${lung1ToIndexGroup}"/>
                    <linearElastic youngModulus="100" poissonRatio="0.4"/>
                    <mass density="0.001"/>
                </region>
                <region id="patMaterial04">
                    <indexgroup indices="${lung2ToIndexGroup}"/>
                    <linearElastic youngModulus="100" poissonRatio="0.4"/>
                    <mass density="0.001"/>
                </region>
            </material>

            <constraints>
              <fixedConstraint name="bodyConstraint" forStep="${initial}" indices="${bottomToIndexGroup}" />
              <surfacePressure name="l1" indices="${lung1facesToIndexGroup}" pressure="50"/>
              <surfacePressure name="l2" indices="${lung2facesToIndexGroup}" pressure="50"/>
            </constraints>

            <output>
                <displacementOutputRequest id="disp01" timestep="1"/>
            </output>
        </object>
    </scene>

    <workflow>    
        <ExtractAllSurfacesByMaterial  id="surfaceExtraction" meshIn="${VolumeMesher}" meshOutFilename="${combo_mesh}" cut="false" />
        <mesherCGALi2v id="VolumeMesher" meshFilename="${tet_only_mesh}" image="${segementation_voxel_image}" 
					facet_angle="20" facet_size="12" facet_distance="3" cell_radius_edge_ratio="3" cell_size="18" odt="false" lloyd="false"  pertube="false" exude="false" />

        <materialId-to-index id="bodyToIndexGroup"
                               num="100" mesh="${surfaceExtraction}"
                               type="elements"/>

        <materialId-to-index id="bonesToIndexGroup"
                               num="25" mesh="${surfaceExtraction}"
                               type="elements"/>

        <materialId-to-index id="lung1ToIndexGroup"
                               num="50" mesh="${surfaceExtraction}"
                               type="elements"/>

        <materialId-to-index id="lung2ToIndexGroup"
                               num="75" mesh="${surfaceExtraction}"
                               type="elements"/>
                               
        <materialId-to-index id="lung1facesToIndexGroup"
                               num="50" mesh="${surfaceExtraction}"
                               type="faces"/>

        <materialId-to-index id="lung2facesToIndexGroup"
                               num="75" mesh="${surfaceExtraction}"
                               type="faces"/>
                               
        <boxROIToIndexOperator id="bottomToIndexGroup"
                               box="-10 190 -10 1000 1000 1000" mesh="${surfaceExtraction}"
                               select="points"/>
    </workflow>


    <environment>
        <solver linearSolver="iterativeCG" processingUnit="GPU"
                timeIntegration="dynamicImplicitEuler"/>
        <simulation>
            <step name="initial" dt="0.05" iterations="100"/>
        </simulation>
    </environment>

</msml:msml>