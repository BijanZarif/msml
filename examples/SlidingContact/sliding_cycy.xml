<msml:msml xmlns:msml="http://sfb125.de/msml"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://sfb125.de/msml ../../test.xsd">
    <variables>
        <var name="input_cube_file" value="cycytubeImage.vtk" logical="Image"
             physical="str"/>	
		<var name="replaced_mat_cube_file" value="replaced_mat_image.vti" logical="Image"
             physical="str"/>				 
		<var name="output_mesh_file" value="meshed_volume.vtk" logical="Mesh"/>     
		<var name="output_moving_volume" value="moving_volume.vtk" logical="Mesh"
             physical="str"/>	
		<var name="output_fixed_volume" value="fixed_volume.vtk" logical="Mesh"
             physical="str"/>	
		<var name="output_moving_surface" value="moving_surface.vtk" logical="Mesh"
             physical="str"/>	
		<var name="output_fixed_surface" value="fixed_surface.vtk" logical="Mesh"
             physical="str"/>	 
    </variables>
	
    <workflow>		
		<!-- 0 is outside, 1 is cylinder body, 2 is smaller piston, 3 is larger piston
			 piston material ids get replaced by same material id: (2,3)->42
		-->
		<ReplaceMaterialID id="ReplaceMovingID" image="cycytubeImage.vtk" replacedImageFile="${replaced_mat_cube_file}" 
						   toReplace="2 3" replaceBy="42"/>
		<!-- mesh with cgal-->
		<CGALMeshVolumeFromVoxels id="VolumeMesher" meshFilename="${output_mesh_file}" image="${ReplaceMovingID}"
                       facetAngle="15" facetSize="3" facetDistance="2" cellSize="8"
                       cellRadiusEdgeRatio="3"  odt="false" lloyd="false" pertube="false"
                       exude="false"/>		
		<!-- select fixed part, outside and cylinder -->			   
		<SelectVolumesByMaterialID id="FixedSplit" selectedVolumesFilename="${output_fixed_volume}" 
													mesh="${VolumeMesher}" group="0 1"/>
		<!-- select moving part, pistons -->
		<SelectVolumesByMaterialID id="MovingSplit" selectedVolumesFilename="${output_moving_volume}" 
										mesh="${VolumeMesher}" group="42"/>			
		<!-- extract surfaces for fixed and moving part -->
		<ExtractSurfaceMesh id="FixedSurface"  mesh="${FixedSplit}"	targetSurfaceMeshFilename="${output_fixed_surface}"/>	
		<!-- extract surfaces for fixed and moving part -->
		<ExtractSurfaceMesh id="MovingSurface"  mesh="${MovingSplit}" targetSurfaceMeshFilename="${output_moving_surface}"/>	
		
  </workflow>
    <environment>		
        <solver linearSolver="iterativeCG" processingUnit="CPU"
                timeIntegration="dynamicImplicitEuler"/>
        <simulation>
            <step name="initial" dt="0.05" iterations="200"/>
        </simulation>	
    </environment>
</msml:msml>